# ice-collector

ice project 的静态分析器, 用来提取 ice 组件的使用情况

## 使用方法: 

```js
import iceCollector from '@ali/ice-collector';
const info = iceCollector.collect(options);

options: {
    description: '项目信息，可不填',
    rootDir: '项目地址，必填',
    basicPackage: '主体包名称，@ali/ice, @alife/next 等',
    // 使用的脚手架工具：ice, fie 等
    kit: 'ice，fie 等'
}
// handle with info
```

## 测试

```bash
tnpm  i -g @ali/ice-collector

DEBUG=ice:collect collector collect --kit ice --basic @ali/ice
```

## 收集信息:

- package.json
- abc.json
- 已安装的模块版本信息
- src 下每个 js/jsx 文件的 import / require 的模块
- 对引入的 ice 基本组件/业务组件/第三方模块 使用情况的分析

## 返回的对象结构: 

```js
{
    "userInfo": "慎里", // 花名或者工号，不存在则为空
    "repoName": "shenli/microtao", // 仓库名
    "kit": "ice",
    "basicPackage": "@ali/ice", // 主体包名称 
    "basicPackageVersion": "^2.0.16"// 主体包版本
    "pkg": {
        // ... 这是 package.json 的内容
    },
    "abc": {
        // ... 这是 abc.json 的内容
    },
    "modules": [ // 项目依赖的模块版本信息
        {
            "module": "@ali/ice", // 模块名称
            "pkgVersion": "~1.0.21", // package.json 中声明的模块版本
            "version": "1.0.23"   // 本地已经安装的模块版本
        },
      // ...
    ],
    "analyzed": { // 每个 js/jsx 文件的 import 或 require 情况
        "components/SubmitToCheck/view.jsx": [
            {
                "importedValue": [ // 引入的模块变量
                    "Upload",
                    "Form",
                    "Feedback",
                    "Field"
                ],
                "fromLiteral": "@ali/ice", // from 后面跟的字符串, 可能是'@ali/ice/lib/button' 这样的
                "fromModule": "@ali/ice"  // from 的模块
            },
            {
                "importedValue": "IceQrcode",
                "fromLiteral": "@ali/ice-qrcode",
                "fromModule": "@ali/ice-qrcode"
            }
        ],
        // ...
    },
    "statistics": { // 简单分析信息
        "basicComponents": [  // 引入的基础组件
            "Checkbox",
            "Button",
            "Dialog",
            "Table",
            "Feedback",
            "Form",
            "Field",
            "Input",
            "Step",
            "Upload"
        ],
        "businessComponents": [ // 引入的业务组件
            "@ali/ice-form-auth-code",
            "@ali/ice-form-text",
            "@ali/ice-qrcode"
        ],
        "thirdModules": [ // 引入的第三方模块
            "react",
            "url-parse",
            "lodash.assign",
            "clipboard",
            "@ali/kissy-io",
            "react-dom"
        ],
        "basicComponentsTimes": { // 引入的基础组件的使用次数
            "Checkbox": 2,
            "Button": 7,
            "Dialog": 3,
            "Table": 1,
            "Feedback": 7,
            "Form": 3,
            "Field": 3,
            "Input": 2,
            "Step": 1,
            "Upload": 1
        },
        "businessComponentsTimes": { // 引入的业务组件的使用次数
            "@ali/ice-form-auth-code": 2,
            "@ali/ice-form-text": 1,
            "@ali/ice-qrcode": 2
        },
        "thirdModulesTimes": { // 引入的第三方模块的使用次数
            "react": 32,
            "url-parse": 3,
            "lodash.assign": 2,
            "clipboard": 1,
            "@ali/kissy-io": 1,
            "react-dom": 2
        }
    }
}
```

